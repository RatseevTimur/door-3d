{"ast":null,"code":"import { Vector3 } from 'three';\nimport { Triangle } from 'three';\nimport { getTriCount } from '../core/utils/geometryUtils.js';\n\n// https://stackoverflow.com/questions/1406029/how-to-calculate-the-volume-of-a-3d-mesh-object-the-surface-of-which-is-made-up\nconst _tri = new Triangle();\nconst _normal = new Vector3();\nconst _relPoint = new Vector3();\nexport function computeMeshVolume(mesh) {\n  // grab the matrix and the geometry\n  let geometry;\n  let matrix;\n  if (mesh.isBufferGeometry) {\n    geometry = mesh;\n    matrix = null;\n  } else {\n    geometry = mesh.geometry;\n    matrix = Math.abs(mesh.matrixWorld.determinant() - 1.0) < 1e-15 ? null : mesh.matrixWorld;\n  }\n\n  // determine the number of relevant draw range elements to use\n  const index = geometry.index;\n  const pos = geometry.attributes.position;\n  const drawRange = geometry.drawRange;\n  const triCount = Math.min(getTriCount(geometry), drawRange.count / 3);\n\n  // get a point relative to the position of the geometry to avoid floating point error\n  _tri.setFromAttributeAndIndices(pos, 0, 1, 2);\n  applyMatrix4ToTri(_tri, matrix);\n  _tri.getNormal(_normal);\n  _tri.getMidpoint(_relPoint).add(_normal);\n\n  // iterate over all triangles\n  let volume = 0;\n  const startIndex = drawRange.start / 3;\n  for (let i = startIndex, l = startIndex + triCount; i < l; i++) {\n    let i0 = 3 * i + 0;\n    let i1 = 3 * i + 1;\n    let i2 = 3 * i + 2;\n    if (index) {\n      i0 = index.getX(i0);\n      i1 = index.getX(i1);\n      i2 = index.getX(i2);\n    }\n\n    // get the triangle\n    _tri.setFromAttributeAndIndices(pos, i0, i1, i2);\n    applyMatrix4ToTri(_tri, matrix);\n    subVectorFromTri(_tri, _relPoint);\n\n    // add the signed volume\n    volume += signedVolumeOfTriangle(_tri.a, _tri.b, _tri.c);\n  }\n  return Math.abs(volume);\n}\nfunction signedVolumeOfTriangle(p1, p2, p3) {\n  const v321 = p3.x * p2.y * p1.z;\n  const v231 = p2.x * p3.y * p1.z;\n  const v312 = p3.x * p1.y * p2.z;\n  const v132 = p1.x * p3.y * p2.z;\n  const v213 = p2.x * p1.y * p3.z;\n  const v123 = p1.x * p2.y * p3.z;\n  return 1 / 6 * (-v321 + v231 + v312 - v132 - v213 + v123);\n}\nfunction subVectorFromTri(tri, pos) {\n  tri.a.sub(pos);\n  tri.b.sub(pos);\n  tri.c.sub(pos);\n}\nfunction applyMatrix4ToTri(tri, mat = null) {\n  if (mat !== null) {\n    tri.a.applyMatrix4(mat);\n    tri.b.applyMatrix4(mat);\n    tri.c.applyMatrix4(mat);\n  }\n}","map":{"version":3,"names":["Vector3","Triangle","getTriCount","_tri","_normal","_relPoint","computeMeshVolume","mesh","geometry","matrix","isBufferGeometry","Math","abs","matrixWorld","determinant","index","pos","attributes","position","drawRange","triCount","min","count","setFromAttributeAndIndices","applyMatrix4ToTri","getNormal","getMidpoint","add","volume","startIndex","start","i","l","i0","i1","i2","getX","subVectorFromTri","signedVolumeOfTriangle","a","b","c","p1","p2","p3","v321","x","y","z","v231","v312","v132","v213","v123","tri","sub","mat","applyMatrix4"],"sources":["/Users/ratseevtimur/Documents/Test-Projects/door-3d/node_modules/three-bvh-csg/src/utils/computeMeshVolume.js"],"sourcesContent":["import { Vector3 } from 'three';\nimport { Triangle } from 'three';\nimport { getTriCount } from '../core/utils/geometryUtils.js';\n\n// https://stackoverflow.com/questions/1406029/how-to-calculate-the-volume-of-a-3d-mesh-object-the-surface-of-which-is-made-up\nconst _tri = new Triangle();\nconst _normal = new Vector3();\nconst _relPoint = new Vector3();\nexport function computeMeshVolume( mesh ) {\n\n\t// grab the matrix and the geometry\n\tlet geometry;\n\tlet matrix;\n\tif ( mesh.isBufferGeometry ) {\n\n\t\tgeometry = mesh;\n\t\tmatrix = null;\n\n\t} else {\n\n\t\tgeometry = mesh.geometry;\n\t\tmatrix = Math.abs( mesh.matrixWorld.determinant() - 1.0 ) < 1e-15 ? null : mesh.matrixWorld;\n\n\t}\n\n\t// determine the number of relevant draw range elements to use\n\tconst index = geometry.index;\n\tconst pos = geometry.attributes.position;\n\tconst drawRange = geometry.drawRange;\n\tconst triCount = Math.min( getTriCount( geometry ), drawRange.count / 3 );\n\n\t// get a point relative to the position of the geometry to avoid floating point error\n\t_tri.setFromAttributeAndIndices( pos, 0, 1, 2 );\n\tapplyMatrix4ToTri( _tri, matrix );\n\t_tri.getNormal( _normal );\n\t_tri.getMidpoint( _relPoint ).add( _normal );\n\n\t// iterate over all triangles\n\tlet volume = 0;\n\tconst startIndex = drawRange.start / 3;\n\tfor ( let i = startIndex, l = startIndex + triCount; i < l; i ++ ) {\n\n\t\tlet i0 = 3 * i + 0;\n\t\tlet i1 = 3 * i + 1;\n\t\tlet i2 = 3 * i + 2;\n\t\tif ( index ) {\n\n\t\t\ti0 = index.getX( i0 );\n\t\t\ti1 = index.getX( i1 );\n\t\t\ti2 = index.getX( i2 );\n\n\t\t}\n\n\t\t// get the triangle\n\t\t_tri.setFromAttributeAndIndices( pos, i0, i1, i2 );\n\t\tapplyMatrix4ToTri( _tri, matrix );\n\t\tsubVectorFromTri( _tri, _relPoint );\n\n\t\t// add the signed volume\n\t\tvolume += signedVolumeOfTriangle( _tri.a, _tri.b, _tri.c );\n\n\t}\n\n\treturn Math.abs( volume );\n\n}\n\nfunction signedVolumeOfTriangle( p1, p2, p3 ) {\n\n\tconst v321 = p3.x * p2.y * p1.z;\n\tconst v231 = p2.x * p3.y * p1.z;\n\tconst v312 = p3.x * p1.y * p2.z;\n\tconst v132 = p1.x * p3.y * p2.z;\n\tconst v213 = p2.x * p1.y * p3.z;\n\tconst v123 = p1.x * p2.y * p3.z;\n\treturn ( 1 / 6 ) * ( - v321 + v231 + v312 - v132 - v213 + v123 );\n\n}\n\nfunction subVectorFromTri( tri, pos ) {\n\n\ttri.a.sub( pos );\n\ttri.b.sub( pos );\n\ttri.c.sub( pos );\n\n}\n\nfunction applyMatrix4ToTri( tri, mat = null ) {\n\n\tif ( mat !== null ) {\n\n\t\ttri.a.applyMatrix4( mat );\n\t\ttri.b.applyMatrix4( mat );\n\t\ttri.c.applyMatrix4( mat );\n\n\t}\n\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}